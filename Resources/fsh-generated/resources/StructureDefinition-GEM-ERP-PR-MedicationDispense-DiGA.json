{
  "resourceType": "StructureDefinition",
  "id": "GEM-ERP-PR-MedicationDispense-DiGA",
  "url": "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_MedicationDispense_DiGA",
  "version": "1.4",
  "name": "GEM_ERP_PR_MedicationDispense_DiGA",
  "title": "Dispensation of a DiGA-Prescription",
  "status": "draft",
  "date": "2024-07-01",
  "description": "Handles information about the dispensed DiGA",
  "fhirVersion": "4.0.1",
  "mapping": [
    {
      "identity": "workflow",
      "uri": "http://hl7.org/fhir/workflow",
      "name": "Workflow Pattern"
    },
    {
      "identity": "rim",
      "uri": "http://hl7.org/v3",
      "name": "RIM Mapping"
    },
    {
      "identity": "w5",
      "uri": "http://hl7.org/fhir/fivews",
      "name": "FiveWs Pattern Mapping"
    },
    {
      "identity": "rx-dispense-rmim",
      "uri": "http://www.hl7.org/v3/PORX_RM020070UV",
      "name": "V3 Pharmacy Dispense RMIM"
    },
    {
      "identity": "v2",
      "uri": "http://hl7.org/v2",
      "name": "HL7 v2 Mapping"
    }
  ],
  "kind": "resource",
  "abstract": false,
  "type": "MedicationDispense",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/MedicationDispense",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "MedicationDispense.meta",
        "path": "MedicationDispense.meta",
        "min": 1
      },
      {
        "id": "MedicationDispense.meta.profile",
        "path": "MedicationDispense.meta.profile",
        "min": 1,
        "max": "1",
        "fixedCanonical": "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_MedicationDispense_DiGA|1.4"
      },
      {
        "id": "MedicationDispense.identifier",
        "path": "MedicationDispense.identifier",
        "short": "ePrescription identifier",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_PrescriptionId"
            ]
          }
        ]
      },
      {
        "id": "MedicationDispense.status",
        "path": "MedicationDispense.status",
        "short": "completed",
        "fixedCode": "completed"
      },
      {
        "id": "MedicationDispense.medication[x]",
        "path": "MedicationDispense.medication[x]",
        "short": "Medical and administrative information about the dispensed DiGA",
        "type": [
          {
            "code": "CodeableConcept"
          }
        ],
        "mustSupport": true
      },
      {
        "id": "MedicationDispense.medication[x].coding",
        "path": "MedicationDispense.medication[x].coding",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "$this"
            }
          ],
          "rules": "closed"
        },
        "min": 1,
        "max": "1"
      },
      {
        "id": "MedicationDispense.medication[x].coding:pznCode",
        "path": "MedicationDispense.medication[x].coding",
        "sliceName": "pznCode",
        "short": "ID of the product (PZN)",
        "definition": "Pharmaceutical Central Number (PZN), which is used by the Information Office for Pharmaceutical Specialties (IFA) in relation to products and is agreed upon with the pharmaceutical industry according to ยง 131 SGB V and with the German Pharmacists' Association according to ยง 300 for statutory health insurance funds. The information such as trade name, dosage form, package size, etc. is derived from the price and product information according to ยง 131 Abs. 4 SGB V.",
        "min": 1,
        "max": "1"
      },
      {
        "id": "MedicationDispense.medication[x].coding:pznCode.system",
        "path": "MedicationDispense.medication[x].coding.system",
        "patternUri": "http://fhir.de/CodeSystem/ifa/pzn"
      },
      {
        "id": "MedicationDispense.medication[x].coding:pznCode.code",
        "path": "MedicationDispense.medication[x].coding.code",
        "min": 1
      },
      {
        "id": "MedicationDispense.medication[x].text",
        "path": "MedicationDispense.medication[x].text",
        "short": "Trade name",
        "definition": "Trade name of the prescribed DiGA, derived from the PZN",
        "min": 1
      },
      {
        "id": "MedicationDispense.subject",
        "path": "MedicationDispense.subject",
        "min": 1
      },
      {
        "id": "MedicationDispense.subject.identifier",
        "path": "MedicationDispense.subject.identifier",
        "short": "The patients KVNR",
        "comment": "There is no PKV identifier available since it is not in the scope for DiGA prescriptions.",
        "min": 1,
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "http://fhir.de/StructureDefinition/identifier-kvid-10"
            ]
          }
        ]
      },
      {
        "id": "MedicationDispense.supportingInformation",
        "path": "MedicationDispense.supportingInformation",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "identifier.value"
            }
          ],
          "rules": "open",
          "ordered": false,
          "description": "Additional Information for using the product"
        },
        "min": 1
      },
      {
        "id": "MedicationDispense.supportingInformation:redeemCode",
        "path": "MedicationDispense.supportingInformation",
        "sliceName": "redeemCode",
        "min": 1,
        "max": "1"
      },
      {
        "id": "MedicationDispense.supportingInformation:redeemCode.identifier.value",
        "path": "MedicationDispense.supportingInformation.identifier.value",
        "min": 1,
        "fixedString": "redeemCode"
      },
      {
        "id": "MedicationDispense.supportingInformation:redeemCode.display",
        "path": "MedicationDispense.supportingInformation.display",
        "short": "Redeem Code",
        "definition": "This code is generated by the health care provider and is to be used to unlock the prescribed DiGA.",
        "min": 1
      },
      {
        "id": "MedicationDispense.supportingInformation:deepLink",
        "path": "MedicationDispense.supportingInformation",
        "sliceName": "deepLink",
        "min": 0,
        "max": "1"
      },
      {
        "id": "MedicationDispense.supportingInformation:deepLink.identifier.value",
        "path": "MedicationDispense.supportingInformation.identifier.value",
        "min": 1,
        "fixedString": "deepLink"
      },
      {
        "id": "MedicationDispense.supportingInformation:deepLink.display",
        "path": "MedicationDispense.supportingInformation.display",
        "short": "Deep Link",
        "definition": "This link is generated by the health care provider and is to be used in order to access the prescribed app directly and redeem the code.",
        "min": 1
      },
      {
        "id": "MedicationDispense.performer",
        "path": "MedicationDispense.performer",
        "min": 1,
        "max": "1"
      },
      {
        "id": "MedicationDispense.performer.actor.identifier",
        "path": "MedicationDispense.performer.actor.identifier",
        "min": 1,
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "http://fhir.de/StructureDefinition/identifier-telematik-id"
            ]
          }
        ]
      },
      {
        "id": "MedicationDispense.whenHandedOver",
        "path": "MedicationDispense.whenHandedOver",
        "short": "Date of dispensation",
        "min": 1,
        "constraint": [
          {
            "key": "workflow-abgabeDatumsFormat",
            "human": "Wert muss ein Datum in der Form: YYYY-MM-DD sein.",
            "source": "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_MedicationDispense_DiGA",
            "severity": "error",
            "expression": "toString().length()=10"
          }
        ]
      },
      {
        "id": "MedicationDispense.dosageInstruction",
        "path": "MedicationDispense.dosageInstruction",
        "mustSupport": true
      }
    ]
  }
}
