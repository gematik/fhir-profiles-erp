{
  "resourceType": "StructureDefinition",
  "id": "GEM-ERP-PR-Task",
  "extension": [
    {
      "url": "http://hl7.org/fhir/StructureDefinition/structuredefinition-category",
      "valueString": "Base.Workflow"
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/structuredefinition-security-category",
      "valueCode": "not-classified"
    }
  ],
  "url": "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_Task",
  "version": "1.2",
  "name": "GEM_ERP_PR_Task",
  "title": "Task for Management of ePrescription Workflow",
  "status": "draft",
  "date": "2020-04-16T14:44:44.4851338+00:00",
  "description": "This resource manages the ePrescription workflow",
  "fhirVersion": "4.0.1",
  "mapping": [
    {
      "identity": "workflow",
      "uri": "http://hl7.org/fhir/workflow",
      "name": "Workflow Pattern"
    },
    {
      "identity": "rim",
      "uri": "http://hl7.org/v3",
      "name": "RIM Mapping"
    },
    {
      "identity": "w5",
      "uri": "http://hl7.org/fhir/fivews",
      "name": "FiveWs Pattern Mapping"
    },
    {
      "identity": "v2",
      "uri": "http://hl7.org/v2",
      "name": "HL7 v2 Mapping"
    }
  ],
  "kind": "resource",
  "abstract": false,
  "type": "Task",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Task",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Task.extension",
        "path": "Task.extension",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "url"
            }
          ],
          "description": "Extensions are always sliced by (at least) url",
          "rules": "closed"
        },
        "min": 1
      },
      {
        "id": "Task.extension:acceptDate",
        "path": "Task.extension",
        "sliceName": "acceptDate",
        "short": "Accept Date of the prescription",
        "definition": "Date when insurance company accepts the prescription.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_EX_AcceptDate"
            ]
          }
        ]
      },
      {
        "id": "Task.extension:expiryDate",
        "path": "Task.extension",
        "sliceName": "expiryDate",
        "short": "Expiry Date of the Prescription",
        "definition": "Date when the prescription is expired and can not be redeemed in the pharmacy.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_EX_ExpiryDate"
            ]
          }
        ]
      },
      {
        "id": "Task.extension:flowType",
        "path": "Task.extension",
        "sliceName": "flowType",
        "short": "Type of the prescription",
        "definition": "Definies the Type of the prescription. The codesystem contains all \"Muster 16\" forms.",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_EX_PrescriptionType"
            ]
          }
        ]
      },
      {
        "id": "Task.identifier",
        "path": "Task.identifier",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "system"
            }
          ],
          "description": "The task ressource contains three identifier. The first one is the identifier for the ask representing one e-prescription. The other identifier are representing the patient as owner of the prescription. One is the \"Krankenversichertennummer\" wich identify each patient by his health insurance company and the other is \"Institutionskennzeichen\".",
          "rules": "closed"
        },
        "min": 1
      },
      {
        "id": "Task.identifier:PrescriptionID",
        "path": "Task.identifier",
        "sliceName": "PrescriptionID",
        "short": "Prescription Identifier",
        "definition": "The prescription identifier is the main identifier for the task ressource and the whole prescription workflow. This identifier is genereted by the \"E-Rezept Fachdienst\" and should not be changed manually.",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_PrescriptionId"
            ]
          }
        ]
      },
      {
        "id": "Task.identifier:AccessCode",
        "path": "Task.identifier",
        "sliceName": "AccessCode",
        "short": "AccessCode Identifier",
        "definition": "Generated by the \"E-Rezept Fachdienst\". This identifier is transported in every task request.",
        "min": 0,
        "max": "1"
      },
      {
        "id": "Task.identifier:AccessCode.system",
        "path": "Task.identifier.system",
        "min": 1,
        "fixedUri": "https://gematik.de/fhir/erp/NamingSystem/GEM_ERP_NS_AccessCode"
      },
      {
        "id": "Task.identifier:AccessCode.value",
        "path": "Task.identifier.value",
        "min": 1
      },
      {
        "id": "Task.identifier:Secret",
        "path": "Task.identifier",
        "sliceName": "Secret",
        "short": "Secret",
        "min": 0,
        "max": "1"
      },
      {
        "id": "Task.identifier:Secret.system",
        "path": "Task.identifier.system",
        "min": 1,
        "fixedUri": "https://gematik.de/fhir/erp/NamingSystem/GEM_ERP_NS_Secret"
      },
      {
        "id": "Task.identifier:Secret.value",
        "path": "Task.identifier.value",
        "min": 1
      },
      {
        "id": "Task.intent",
        "path": "Task.intent",
        "fixedCode": "order",
        "mustSupport": true
      },
      {
        "id": "Task.for",
        "path": "Task.for",
        "short": "Identifier of Patient (KVID)",
        "definition": "The entity who benefits from the performance of the service specified in the task (e.g., the patient). Will be filled upon $activate-operation",
        "mustSupport": true
      },
      {
        "id": "Task.for.identifier",
        "path": "Task.for.identifier",
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "http://fhir.de/StructureDefinition/identifier-kvid-10"
            ]
          }
        ]
      },
      {
        "id": "Task.performerType",
        "path": "Task.performerType",
        "definition": "The Institution in which the patient should redeem his prescription.",
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/erp/ValueSet/GEM_ERP_VS_OrganizationType"
        }
      },
      {
        "id": "Task.performerType.coding",
        "path": "Task.performerType.coding",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.input",
        "path": "Task.input",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "type.coding.code"
            }
          ],
          "rules": "closed"
        },
        "short": "Input Bundle",
        "definition": "Referenz to the whole JSON-Bundle of the patient and the Health Care Provider Bundle",
        "max": "2",
        "mustSupport": true
      },
      {
        "id": "Task.input:ePrescription",
        "path": "Task.input",
        "sliceName": "ePrescription",
        "min": 0,
        "max": "1"
      },
      {
        "id": "Task.input:ePrescription.type",
        "path": "Task.input.type",
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/erp/CodeSystem/GEM_ERP_VS_DocumentType"
        }
      },
      {
        "id": "Task.input:ePrescription.type.coding.system",
        "path": "Task.input.type.coding.system",
        "min": 1,
        "fixedUri": "ttps://gematik.de/fhir/erp/CodeSystem/GEM_ERP_VS_DocumentType"
      },
      {
        "id": "Task.input:ePrescription.type.coding.code",
        "path": "Task.input.type.coding.code",
        "min": 1,
        "fixedCode": "1"
      },
      {
        "id": "Task.input:ePrescription.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_Binary"
            ],
            "aggregation": [
              "referenced",
              "bundled"
            ]
          }
        ]
      },
      {
        "id": "Task.input:ePrescription.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": false
      },
      {
        "id": "Task.input:ePrescription.value[x].identifier",
        "path": "Task.input.value[x].identifier",
        "mustSupport": false
      },
      {
        "id": "Task.input:patientReceipt",
        "path": "Task.input",
        "sliceName": "patientReceipt",
        "min": 0,
        "max": "1"
      },
      {
        "id": "Task.input:patientReceipt.type",
        "path": "Task.input.type",
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/erp/CodeSystem/GEM_ERP_VS_DocumentType"
        }
      },
      {
        "id": "Task.input:patientReceipt.type.coding.system",
        "path": "Task.input.type.coding.system",
        "min": 1,
        "fixedUri": "https://gematik.de/fhir/erp/CodeSystem/GEM_ERP_VS_DocumentType"
      },
      {
        "id": "Task.input:patientReceipt.type.coding.code",
        "path": "Task.input.type.coding.code",
        "min": 1,
        "fixedCode": "2"
      },
      {
        "id": "Task.input:patientReceipt.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Bundle"
            ],
            "aggregation": [
              "referenced",
              "bundled"
            ]
          }
        ]
      },
      {
        "id": "Task.input:patientReceipt.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": false
      },
      {
        "id": "Task.output",
        "path": "Task.output",
        "code": [
          {
            "system": "https://gematik.de/fhir/erp/CodeSystem/FlowType",
            "userSelected": true
          }
        ],
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "type.coding.code"
            }
          ],
          "rules": "closed"
        },
        "short": "Output Bundle",
        "definition": "Referenz to the Bundle wich represent the receipt.",
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Task.output:receipt",
        "path": "Task.output",
        "sliceName": "receipt",
        "min": 0,
        "max": "1"
      },
      {
        "id": "Task.output:receipt.type",
        "path": "Task.output.type",
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/erp/CodeSystem/GEM_ERP_VS_DocumentType"
        }
      },
      {
        "id": "Task.output:receipt.type.coding.system",
        "path": "Task.output.type.coding.system",
        "min": 1,
        "fixedUri": "https://gematik.de/fhir/erp/CodeSystem/GEM_ERP_VS_DocumentType"
      },
      {
        "id": "Task.output:receipt.type.coding.code",
        "path": "Task.output.type.coding.code",
        "min": 1,
        "fixedCode": "3"
      },
      {
        "id": "Task.output:receipt.value[x]",
        "path": "Task.output.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://gematik.de/fhir/erp/StructureDefinition/GEM_ERP_PR_Bundle"
            ],
            "aggregation": [
              "referenced",
              "bundled"
            ]
          }
        ]
      },
      {
        "id": "Task.output:receipt.value[x].reference",
        "path": "Task.output.value[x].reference",
        "min": 1,
        "mustSupport": false
      }
    ]
  }
}
